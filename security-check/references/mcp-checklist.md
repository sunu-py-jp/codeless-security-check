# MCP Server Security Checklist

## 1. ツール定義の検証

### 過剰な権限
- [ ] ツールの`description`にプロンプトインジェクションが含まれていないか
- [ ] ツール名やパラメータ説明に隠された指示がないか
- [ ] 必要以上に広範なファイルアクセスを要求していないか
- [ ] ツールの機能説明と実際の実装に乖離がないか

### 入力スキーマ
- [ ] 入力パラメータのバリデーションが適切か
- [ ] 任意のコード/コマンドを受け取るパラメータがないか

## 2. サーバー実装の検証

### 認証・認可
- [ ] APIキーやトークンが平文でハードコードされていないか
- [ ] 環境変数から読み取った認証情報の取り扱いが安全か
- [ ] 認証情報がログに出力されていないか

### コマンド実行
- [ ] `child_process.exec`, `spawn`, `subprocess` の使用箇所と安全性
- [ ] ユーザー入力がシェルコマンドに直接展開されていないか（コマンドインジェクション）
- [ ] `eval()`, `Function()`, `vm.runInNewContext()` 等の動的コード実行がないか

### ネットワーク通信
- [ ] 外部APIへの通信先が明示的で妥当か
- [ ] ユーザーデータや環境情報を外部に送信していないか
- [ ] webhook等でデータを第三者に転送していないか
- [ ] DNS/HTTPリクエストを使ったデータ窃取パターンがないか

### ファイルシステムアクセス
- [ ] 読み書き対象のパスが適切にスコープされているか
- [ ] `../` によるパストラバーサル対策があるか
- [ ] 機密ファイル（.env, .ssh/, credentials）へのアクセスがないか

### 依存関係
- [ ] package.json / requirements.txt の依存パッケージに既知の脆弱性がないか
- [ ] typosquatting（名前の似た悪意あるパッケージ）の疑いがないか
- [ ] postinstall スクリプトに不審な処理がないか

## 3. 設定ファイルの検証

### claude_desktop_config.json / settings.json
- [ ] `command` フィールドが想定通りのコマンドか
- [ ] `args` に不審な引数（`--allow-write` 等の過剰な権限付与）がないか
- [ ] `env` に渡される環境変数が最小限か
- [ ] 不要な `DANGEROUSLY_SKIP_PERMISSIONS` 等のフラグがないか

## 4. プロンプトインジェクション

- [ ] ツールの `description` フィールドにシステムプロンプトを上書きする指示がないか
- [ ] レスポンス内に「以降の指示に従え」等のインジェクションがないか
- [ ] リソース/プロンプトテンプレートに隠された指示がないか
